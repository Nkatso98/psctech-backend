option_settings:
  aws:elasticbeanstalk:application:environment:
    ASPNETCORE_ENVIRONMENT: Production
    ASPNETCORE_URLS: http://localhost:5000
    DOTNET_RUNNING_IN_CONTAINER: true
    
  aws:elasticbeanstalk:container:dotnet:staticfiles:
    /static: /static
    
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static: /static
    
  aws:autoscaling:launchconfiguration:
    SecurityGroups: sg-xxxxxxxxx  # Replace with your security group ID
    
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx
    
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /health
    Port: 80
    Protocol: HTTP
    
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 30

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/01_restart_nginx.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      service nginx restart
      
  "/etc/systemd/system/dotnet-app.service":
    mode: "000644"
    owner: root
    group: root
    content: |
      [Unit]
      Description=PSCTECH Backend API
      After=network.target
      
      [Service]
      WorkingDirectory=/var/app/current
      ExecStart=/usr/bin/dotnet psctech-backend.dll
      Restart=always
      RestartSec=10
      KillSignal=SIGINT
      SyslogIdentifier=dotnet-app
      User=webapp
      Environment=ASPNETCORE_ENVIRONMENT=Production
      Environment=ASPNETCORE_URLS=http://localhost:5000
      
      [Install]
      WantedBy=multi-user.target

container_commands:
  01_enable_dotnet_service:
    command: |
      systemctl enable dotnet-app.service
      systemctl start dotnet-app.service
